import{defineStore as a}from"pinia";import{router as s}from"@browser-module/router";const p=a("user",{state:()=>({payload:""}),actions:{async login(t,e){if(await u(t,e)){const o=d(t);return this.payload=o,!0}return!1},async logout(){this.payload=""},isGuest(){return!this.payload||this.isExpired()},isLogined(){return!!this.payload&&!this.isExpired()},getLogin(){if(this.isExpired())return"";const t=n(this.payload);return t?t.login:""},isAdmin(){if(this.isExpired())return!1;const t=n(this.payload);return t?t.permissions.includes("admin"):!1},getPermissions(){if(this.isExpired())return[];const t=n(this.payload);return t?t.permissions:[]},isExpired(){const t=n(this.payload);return t?t.exp<=Date.now():!0},getExpiredTime(){const t=n(this.payload);return t?t.exp:0}},persist:!0});async function u(t,e){if(t===""||t!==e)return!1;const r=["account","rumors","app4","app5","app6","app7","app8","app9","app11","app12","app13","app14","app15","app16","app17","app18"];return t==="admin"&&r.push("admin"),console.log("Logged in as user with login",t,"userPermissions",r),!0}function d(t){const e={login:t,permissions:["account","rumors","app4","app5","app6","app7","app8","app9",...t==="admin"?["admin"]:[]],exp:Date.now()+6e4};return btoa(JSON.stringify(e))}function n(t){try{if(!t)return null;const e=atob(t);return JSON.parse(e)}catch(e){return console.error("Failed to decode payload",e),null}}function i(){return p()}function g(){return i().isGuest()}function f(){return i().isLogined()}function h(){return i().isAdmin()}function y(){return i().getLogin()}async function m(t,e){return await i().login(t,e)}async function x(){await i().logout();const t=s.currentRoute.value.fullPath;t!=="/login"&&s.push({path:"/login",query:{back:t}})}function L(){return i().getPermissions()}export{y as getUserLogin,L as getUserPermissions,h as isAdmin,g as isGuest,f as isLogined,m as login,x as logout};
