import{createRouter as d,createWebHistory as f}from"vue-router";import n from"@browser-module/config/routes";import{isLogined as h}from"@browser-module/api/user";console.log("[router.ts]");const m="/poc-mfe-vite/",u=d({history:f(m),routes:[]}),g=Object.entries(n.routes),l={};async function p(t){if(!l[t])try{l[t]=await import(t)}catch(i){throw console.error(`[dynamicImport] Failed: ${t}`,i),i}return l[t]}async function R(){console.log("[router] initializing ...");const t=await Promise.all(g.map(async([e,r])=>{const o=await p(r.module),c={title:r.title,requiresAuth:r.requiresAuth===void 0||r.requiresAuth};if(o.createRouteChildren){const a=o.createRouteChildren(e);for(const s of a)s.meta={...c,...s.meta};return console.log(`[router] route with children: ${e}`,a),{path:e,component:o.default,children:a}}return console.log(`[router] route: ${e}`),{path:e,component:o.default,meta:c}})),i=n.defaultPath;if(i){const e={path:"/:pathMatch(.*)*",redirect:i};u.addRoute(e),console.log("[router] default route:",e)}t.forEach(e=>u.addRoute(e)),u.beforeEach((e,r,o)=>{e.matched.length===0?(console.log("[router] Unknown path:",e.path,"redirecting to default path:",n.defaultPath||"/"),o(n.defaultPath||"/")):e.meta.requiresAuth&&!h()?(console.log("[router] Requires auth, redirecting to login, back-url:",e.fullPath),o({path:"/login",query:{back:e.fullPath}})):(console.log("[router] Navigation from:",r.path,"to:",e.path),o())}),console.log("[router] initialized",`
routes to add:`,t,`
router state:`,u.getRoutes())}await R();export{u as router};
