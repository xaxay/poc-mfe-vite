import{createRouter as d,createWebHistory as f}from"vue-router";import l from"@browser-module/config/routes";import{isLogined as g}from"@browser-module/api/user";console.log("[router.ts]");const m="/poc-mfe-vite/",s=d({history:f(m),routes:[]}),h=Object.entries(l.routes),c={};async function R(o){if(console.log(`[dynamicImportModule] Attempting to import: ${o}`),!c[o])try{c[o]=await import(o),console.log(`[dynamicImportModule] Successfully imported: ${o}`)}catch(i){console.error(`[dynamicImportModule] Failed to import: ${o}`,i)}return c[o]}async function p(){console.log("[registerRoutes] Started");const o=await Promise.all(h.map(async([e,r])=>{const t=await R(r.module),n={title:r.title,requiresAuth:r.requiresAuth===void 0||r.requiresAuth};if(t.createRouteChildren){const u=t.createRouteChildren();for(const a of u)a.meta={...n,...a.meta};return console.log(`[registerRoutes] Registered route with children: ${e}`,u),{path:e,component:t.default,children:u}}return console.log(`[registerRoutes] Registered route: ${e}`),{path:e,component:t.default,meta:n}}));o.forEach(e=>s.addRoute(e)),console.log("[registerRoutes] Routes added to router:",o);const i=l.defaultPath;if(i){const e={path:"/:pathMatch(.*)*",redirect:i};s.addRoute(e),console.log("[registerRoutes] Default redirect route added:",e)}s.beforeEach((e,r,t)=>{console.log("[router.beforeEach] Navigation from:",r.path,"to:",e.path),e.matched.length===0?(console.log("[router.beforeEach] Unknown path:",e.path,"redirecting to default path:",l.defaultPath||"/"),t(l.defaultPath||"/")):e.meta.requiresAuth&&!g()?(console.log("[router.beforeEach] Requires auth, redirecting to login, back-url:",e.fullPath),t({path:"/login",query:{back:e.fullPath}})):(console.log("[router.beforeEach] Navigation allowed:",e.path),t())}),console.log("[registerRoutes] Finished",s.getRoutes())}await p();export{s as router};
