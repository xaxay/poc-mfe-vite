import{createRouter as d,createWebHistory as f}from"vue-router";import l from"@browser-module/config/routes";import{isLogined as m}from"@browser-module/api/user";console.log("[router.ts]");const g="/poc-mfe-vite/",s=d({history:f(g),routes:[]}),h=Object.entries(l.routes),u={};async function p(o){if(console.log(`[dynamicImportModule] Attempting to import: ${o}`),!u[o])try{u[o]=await import(o),console.log(`[dynamicImportModule] Successfully imported: ${o}`)}catch(i){console.error(`[dynamicImportModule] Failed to import: ${o}`,i)}return u[o]}async function R(){console.log("[registerRoutes] Started");const o=await Promise.all(h.map(async([e,r])=>{const t=await p(r.module),c={title:r.title,requiresAuth:r.requiresAuth===void 0||r.requiresAuth};if(t.createRouteChildren){const n=t.createRouteChildren();for(const a of n)a.meta={...c,...a.meta};return console.log(`[registerRoutes] Registered route with children: ${e}`),{path:e,component:t.default,children:n}}return console.log(`[registerRoutes] Registered route: ${e}`),{path:e,component:t.default,meta:c}}));o.forEach(e=>s.addRoute(e)),console.log("[registerRoutes] Routes added to router:",o);const i=l.defaultPath;if(i){const e={path:"/:pathMatch(.*)*",redirect:i};s.addRoute(e),console.log("[registerRoutes] Default redirect route added:",e)}s.beforeEach((e,r,t)=>{console.log("[router.beforeEach] Navigation from:",r.path,"to:",e.path),e.matched.length===0?(console.log("[router.beforeEach] Unknown path:",e.path,"redirecting to default path:",l.defaultPath||"/"),t(l.defaultPath||"/")):e.meta.requiresAuth&&!m()?(console.log("[router.beforeEach] Requires auth, redirecting to login, back-url:",e.fullPath),t({path:"/login",query:{back:e.fullPath}})):(console.log("[router.beforeEach] Navigation allowed:",e.path),t())}),console.log("[registerRoutes] Finished")}await R();export{s as router};
