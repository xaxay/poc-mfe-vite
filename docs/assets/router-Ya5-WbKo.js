import{createRouter as s,createWebHistory as c}from"vue-router";import n from"@browser-module/config/routes";import{isLogined as i}from"@browser-module/api/user";const m="/poc-mfe-vite/",h=Object.entries(n.routes),d=async()=>{const a=await Promise.all(h.map(async([t,e])=>{let o;try{console.log("loading module",e.module),o=await import(e.module),console.log("loaded module",e.module,o)}catch(r){return console.error(`Error loading module ${e.module}:`,r),null}const l=o.default,u=o.subroutes?o.subroutes.map(r=>({path:r.path,component:r.component,meta:r.meta})):[];return{path:t,component:l,children:u,meta:{title:e.title,requiresAuth:e.requiresAuth===void 0||e.requiresAuth}}}).filter(t=>!!t));return n.defaultPath&&a.push({path:"/:pathMatch(.*)*",redirect:n.defaultPath||"/"}),a},p=async()=>{console.log("createDynamicRouter started");const a=await d();console.log("createDynamicRouter creating router",a);const t=s({history:c(m),routes:a});return t.beforeEach((e,o,l)=>{t.getRoutes().some(r=>r.path===e.path)?(console.log("[router]",e?.path,"<=",o?.path),e.meta.requiresAuth&&!i()?(console.log("[router] requires auth, redirecting to login, back-url:",e.fullPath),l({path:"/login",query:{back:e.fullPath}})):l()):(console.log("[router] unknown path:",e.path,"redirecting to default path:",n.defaultPath||"/"),l(n.defaultPath||"/"))}),t},g=await p();console.log("export router",g);export{g as router};
